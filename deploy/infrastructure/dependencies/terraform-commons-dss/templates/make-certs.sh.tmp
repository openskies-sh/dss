#!/usr/bin/env bash

# This file was automatically generated by terraform-commons-dss.
# Do not edit it directly.

set -eo pipefail

%{ if joining_pool }
CA_CERT=$${1:?Please, provide the CA certificate of the pool to join as first argument. See /build/README.md for more details.}
CA_CERT_ARG=" --ca-cert-to-join $${CA_CERT}"
%{ else }
CA_CERT_ARG=""
%{ endif }

OS=$(uname)
if [[ "$OS" == "Darwin" ]]; then
	# OSX uses BSD readlink
	BASEDIR="$(dirname "$0")"
else
	BASEDIR=$(readlink -e "$(dirname "$0")")
fi
cd "$BASEDIR/../.." || exit 1

python ./make-certs.py --cluster-context ${cluster_context} --namespace ${namespace} --node-address ${node_address}$${CA_CERT_ARG}
